<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¼ ë ›ì„œíŒë‹¤ ì„ìš© ê³µë¶€</title>

<style>
body{
  margin:0; font-family:'Pretendard','Apple SD Gothic Neo',sans-serif;
  background:#fff6ec; color:#5d4037;
}
.hidden{display:none;}
.center{
  min-height:100vh; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:20px;
}
.btn{
  padding:14px 22px; border-radius:20px; border:none;
  background:#ff8a65; color:#fff; font-weight:700;
  cursor:pointer;
}
.btn.secondary{background:#ffd180; color:#5d4037;}
header{
  background:#fff; padding:14px 18px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.container{max-width:900px; margin:20px auto; padding:0 16px;}
.menu{display:flex; gap:12px; justify-content:center; flex-wrap:wrap;}
.card{
  background:#fff; border-radius:22px; padding:20px;
  box-shadow:0 10px 20px rgba(0,0,0,.08);
  margin-top:20px;
}
select, textarea, input{
  width:100%; padding:10px; margin:6px 0 14px;
  border-radius:14px; border:1px solid #ddd;
}
</style>
</head>

<body>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="start" class="center">
  <img src="https://upload.wikimedia.org/wikipedia/commons/5/50/RedPandaFullBody.JPG" width="160">
  <h1>ğŸ¼ ë ›ì„œíŒë‹¤ ì„ìš© ê³µë¶€</h1>
  <button class="btn" id="startBtn">ê³µë¶€í•˜ê¸°</button>
</div>

<!-- ë©”ì¸ -->
<div id="main" class="hidden">
<header><h2>ğŸ¾ ì˜¤ëŠ˜ë„ ì„ìš© ê³µë¶€!</h2></header>

<div class="container">
  <div class="menu">
    <button class="btn" data-page="solve">ë¬¸ì œ í’€ê¸°</button>
    <button class="btn secondary" data-page="add">ë¬¸ì œ ë§Œë“¤ê¸°</button>
    <button class="btn secondary" data-page="view">ë¬¸ì œ ë³´ê¸°</button>
  </div>

  <!-- ë¬¸ì œ í’€ê¸° -->
  <div id="solve" class="card hidden">
    <h3>ğŸ“ ë¬¸ì œ í’€ê¸°</h3>

    <label>ê³¼ëª©</label>
    <select id="quizSubject"></select>

    <label>ë‹¨ì›</label>
    <select id="quizUnit"></select>

    <button class="btn" id="startUnit">ë‹¨ì› í’€ì´</button>
    <button class="btn secondary" id="startRandom">ëœë¤ ğŸ²</button>

    <hr>

    <h4 id="question">ë¬¸ì œ</h4>
    <textarea id="answerInput" rows="3"></textarea>
    <button class="btn" id="checkBtn">ì •ë‹µ í™•ì¸</button>
    <p id="result"></p>
  </div>

  <!-- ë¬¸ì œ ë§Œë“¤ê¸° -->
  <div id="add" class="card hidden">
    <h3>â• ë¬¸ì œ ë§Œë“¤ê¸°</h3>

    <label>ê³¼ëª©</label>
    <select id="addSubject">
      <option>ë™ì–‘ì‚¬ê°œë¡ </option>
      <option>ì„œì–‘ì‚¬ê°œë¡ </option>
      <option>ì‹œë¯¼ì˜ í•œêµ­ì‚¬</option>
    </select>

    <label>ê¸°ì¡´ ë‹¨ì›</label>
    <select id="addUnit"></select>

    <input id="newUnit" placeholder="ìƒˆ ë‹¨ì› ì§ì ‘ ì…ë ¥">

    <textarea id="newQ" rows="3" placeholder="ë¬¸ì œ"></textarea>
    <textarea id="newA" rows="2" placeholder="ì •ë‹µ í‚¤ì›Œë“œ"></textarea>

    <button class="btn" id="saveBtn">ì €ì¥ ğŸ¾</button>
  </div>

  <!-- ë¬¸ì œ ë³´ê¸° -->
  <div id="view" class="card hidden">
    <h3>ğŸ“‚ ë¬¸ì œ ë³´ê¸°</h3>
    <div id="list"></div>
  </div>
</div>
</div>

<script>
// ===== ì‹œì‘ ë²„íŠ¼ =====
startBtn.onclick = () => {
  start.classList.add('hidden');
  main.classList.remove('hidden');
};

// ===== ë©”ë‰´ ì „í™˜ =====
document.querySelectorAll('.menu button').forEach(btn=>{
  btn.onclick = ()=>{
    ['solve','add','view'].forEach(id=>{
      document.getElementById(id).classList.add('hidden');
    });
    document.getElementById(btn.dataset.page).classList.remove('hidden');
  };
});

// ===== ë°ì´í„° =====
const UNIT_KEY = 'units';
const Q_KEY = 'questions';

let unitData = JSON.parse(localStorage.getItem(UNIT_KEY)) || {
  'ë™ì–‘ì‚¬ê°œë¡ ': [],
  'ì„œì–‘ì‚¬ê°œë¡ ': [],
  'ì‹œë¯¼ì˜ í•œêµ­ì‚¬': []
};

let questions = JSON.parse(localStorage.getItem(Q_KEY)) || [];

localStorage.setItem(UNIT_KEY, JSON.stringify(unitData));

// ===== ë¬¸ì œ ë§Œë“¤ê¸° =====
function updateAddUnit(){
  addUnit.innerHTML='';
  unitData[addSubject.value].forEach(u=>{
    addUnit.innerHTML+=`<option>${u}</option>`;
  });
}
addSubject.onchange = updateAddUnit;
updateAddUnit();

saveBtn.onclick = ()=>{
  const unit = newUnit.value || addUnit.value;
  if(!unit || !newQ.value || !newA.value){
    alert('ëª¨ë‘ ì…ë ¥!');
    return;
  }

  if(!unitData[addSubject.value].includes(unit)){
    unitData[addSubject.value].push(unit);
    localStorage.setItem(UNIT_KEY, JSON.stringify(unitData));
    updateAddUnit();
  }

  questions.push({
    subject:addSubject.value,
    unit,
    q:newQ.value,
    answer:newA.value,
    wrong:0
  });

  localStorage.setItem(Q_KEY, JSON.stringify(questions));
  newQ.value=newA.value=newUnit.value='';
  alert('ì €ì¥ ì™„ë£Œ ğŸ¼');
};

// ===== ë¬¸ì œ í’€ê¸° =====
function initQuiz(){
  quizSubject.innerHTML='';
  Object.keys(unitData).forEach(s=>{
    quizSubject.innerHTML+=`<option>${s}</option>`;
  });
  quizSubject.onchange=()=>{
    quizUnit.innerHTML='';
    unitData[quizSubject.value].forEach(u=>{
      quizUnit.innerHTML+=`<option>${u}</option>`;
    });
  };
  quizSubject.onchange();
}
initQuiz();

let quizList=[], idx=0;

function loadQuiz(){
  if(!quizList.length){
    question.textContent='ë¬¸ì œê°€ ì—†ì–´ìš” ğŸ¼';
    return;
  }
  question.textContent=quizList[idx].q;
  answerInput.value='';
  result.textContent='';
}

startUnit.onclick=()=>{
  quizList=questions.filter(q=>q.subject===quizSubject.value&&q.unit===quizUnit.value);
  idx=0; loadQuiz();
};

startRandom.onclick=()=>{
  quizList=[...questions].sort(()=>Math.random()-0.5);
  idx=0; loadQuiz();
};

checkBtn.onclick=()=>{
  const q=quizList[idx];
  if(answerInput.value.includes(q.answer)){
    result.textContent='â­• ì •ë‹µ!';
    idx=(idx+1)%quizList.length;
    setTimeout(loadQuiz,500);
  }else{
    result.textContent='âŒ ì˜¤ë‹µ';
    q.wrong++;
    localStorage.setItem(Q_KEY, JSON.stringify(questions));
  }
};

// ===== ë¬¸ì œ ë³´ê¸° =====
function renderList(){
  list.innerHTML='';
  questions.forEach(q=>{
    list.innerHTML+=`${q.q} (âŒ ${q.wrong})<br>`;
  });
}
renderList();
</script>
</body>
</html>
